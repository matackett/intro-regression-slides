---
title: "Simple Linear Regression"
subtitle: "Inference"
author: "Dr. Maria Tackett"
output:
  xaringan::moon_reader:
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    css: "slides.css"
    logo: "img/introregression-sticker.png"
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 4:3
      slideNumberFormat: "%current%"
    seal: false #make custom title slide
editor_options: 
  chunk_output_type: console
---

```{r child = "setup.Rmd"}
```

class: title-slide 

<br><br>

# Simple Linear Regression 
## Inference

<br><br><br>

### Dr. Maria Tackett

---

## Topics 

--


  
--



```{r packages, echo = F}
library(tidyverse)
library(broom)
library(knitr)
library(kableExtra)
library(patchwork)
library(fivethirtyeight)
```

```{r data}
movie_scores <- fandango %>%
  rename(critics = rottentomatoes, 
         audience = rottentomatoes_user)
```

---

## Movie ratings data 

The data set contains the "Tomatometer" score (.term[critics]) and audience score (.term[audience]) for 146 movies rated on rottentomatoes.com. 

```{r}
ggplot(data = movie_scores, mapping = aes(x = critics, y = audience)) +
  geom_point(alpha = 0.5) + 
  labs(x = "Critics Score" , 
       y = "Audience Score") +
  theme_bw() +
  theme(axis.title=element_text(size=14))
```


---

## The model

$$\color{red}{\hat{\text{audience}} = 32.316 + 0.519 \times \text{critics}}$$

```{r}
model <- lm(audience ~ critics, data = movie_scores)
```

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3)
```


```{r}
ggplot(data = movie_scores, mapping = aes(x = critics, y = audience)) +
  geom_point(alpha = 0.5) + 
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(x = "Critics Score" , 
       y = "Audience Score") +
  theme_bw() +
  theme(axis.title=element_text(size=14))
```

---

## Questions of interest

--

Is there truly linear relationship between `critics` and `audience`, or is the relationshp we observed $(\hat{\beta}_1 = 0.519)$ due to random chance? 

<br> 

--

What is a plausible range of values of $\beta$, the true population slope for `critics`? 

---

class: middle

### Is there truly linear relationship between `critics` and `audience`, or is the relationshp we observed $(\hat{\beta}_1 = 0.519)$ due to random chance? 


---

## Outline of a hypothesis test

`r emo::ji('one')` State the hypotheses.

`r emo::ji('two')` Calculate the test statistic. 

`r emo::ji('three')` Calculate the p-value.

`r emo::ji('four')` State the conclusion. 

---

## `r emo::ji('one')` State the hypotheses

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3)
```

<br>

.pull-left[
.small-box[
$$\large{\begin{aligned}& H_0: \beta_1 = 0\\& H_a: \beta_1 \neq 0\end{aligned}}$$
]
]

---

## `r emo::ji('one')` State the hypotheses

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3)
```

<br>

.pull-left[
.small-box[
$$\large{\begin{aligned}& H_0: \beta_1 = 0\\& H_a: \beta_1 \neq 0\end{aligned}}$$
]
]

.pull-right[
<font color = "white">place-holder</font>

.big[.vocab[Null hypothesis]]


]

---

## `r emo::ji('one')` State the hypotheses

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3)
```

<br>

.pull-left[
.small-box[
$$\large{\begin{aligned}& H_0: \beta_1 = 0\\& H_a: \beta_1 \neq 0\end{aligned}}$$
]
]

.pull-right[
<font color = "white">place-holder</font>
 
.big[.vocab[Null hypothesis]]

.big[.vocab[Alternative hypothesis]]

]

---

## `r emo::ji('two')` Calculate the test statistic

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3)
```

<br> 

.eq[
$$\text{test statistic} = \frac{\text{Estimate} - \text{Hypothesized}}{\text{Standard error}}$$
]

---

## `r emo::ji('two')` Calculate the test statistic

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3) %>%
  row_spec(2, background = "#dce5b2")
```

<br> 

--

.pull-left[
.eq[
$$t = \frac{{\hat{\beta}_1} - 0}{\text{SE}_{\hat{\beta}_1}}$$
]
]

--

.pull-right[

.small-box-work[
$$\begin{aligned}t &= \frac{0.5187 - 0}{0.0345}\\
&= \mathbf{15.03}\end{aligned}$$
]
]

---

## `r emo::ji('three')` Calculate the p-value

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3) %>%
  row_spec(2, background = "#dce5b2")
```

<br> 

.eq[
$$\text{p-value} = P(t \geq |\text{test statistic}|)$$
]

Calculated from a $t$ distribution with $n-2$ degrees of freedom

---

## `r emo::ji('three')` Calculate the p-value

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3) %>%
  row_spec(2, background = "#dce5b2")
```

<br> 

```{r echo = F}
ggplot(data.frame(x = c(-4, 4)), aes(x)) +
  stat_function(fun = dt, args =list(df =144)) +
  stat_function(fun = dt,   args =list(df =144),
                xlim = c(-4, -1.5),
                geom = "area", fill = "steelblue") + 
    stat_function(fun = dt,   args =list(df =144),
                xlim = c(1.5, 4),
                geom = "area", fill = "steelblue") +
    labs(x = "t", 
         y = "density") + 
    annotate("text", x = 2.5, y = 0.35, label = "df = 144", size = 5) +
  theme_classic()
```

---

## Understanding the p-value

|  Magnitude of p-value |             Interpretation            |
|:---------------------:|:-------------------------------------:|
| p-value < 0.01        | strong evidence against $H_0$         |
| 0.01 < p-value < 0.05 | moderate evidence against $H_0$       |
| 0.05 < p-value < 0.1  | weak evidence against $H_0$           |
| p-value > 0.1         | effectively no evidence against $H_0$ |

<br> 
<br>

*These are general guidelines. The strength of evidence depends on the context of the problem.*

---

## `r emo::ji('four')` State the conclusion

```{r}
model %>%
  tidy() %>%
  kable(format = "html", digits = 3) %>%
  row_spec(2, background = "#dce5b2")
```

<br> 

.vocab[The data provide sufficient evidence that there is a linear relationship between the critics score and audience score for movies on rottentomatoes.com. ]


---

class: middle, center

### What is a plausible range of values of $\beta_1$, the true population slope for `critics` (?

---

## General form of the confidence interval


.eq[
$$\Large{\text{ Estimate} \pm \text{ (critical value) } \times \text{SE}}$$
]

---

## Confidence interval for $\beta_1$

.eq[
$$\Large{\hat{\beta}_1 \pm t^* SE(\hat{\beta}_1)}}$$
]

- $t^*$ is the critical value associated with the confidence level.
  + It is calculated from a $t$ distribution with $n-2$ degrees of freedom
  
- $SE(\hat{\beta}_1)$ is the standard error for the slope 

$$SE(\hat{\beta}_1) = \sqrt{\frac{\hat{\sigma}^2}{\sum\limits_{i=1}^n (x_i - \bar{x})^2}} \hspace{2.5mm} = \hspace{2.5mm} \hat{\sigma}\sqrt{\frac{1}{(n-1)s_X^2}}$$

---

### What is $\hat{\sigma}$?

- Recall, the residual is the difference between the observed response the predicted response (the estimated mean) 
    - The residual for the ith observation, $(x_i, y_i)$, is
    
    $$e_i = y_i - (\hat{\beta}_0 + \hat{\beta}_1 x_i)$$ 

- The <font class = "vocab">Residual Standard Error</font> is the estimate of variation about the regression line
    - Also known as the **Root Mean Square Error (RMSE)**

.alert[
$$\hat{\sigma} = \sqrt{\frac{1}{n-2}\sum\limits_{i=1}^{n} e_i^2}$$
]
---

### Why *t*? 

.alert[
$$\hat{\beta}_1 \sim N \Bigg(\beta_1, \sigma\sqrt{\frac{1}{(n-1)s_X^2}} \Bigg)$$
]

- We don't know $\sigma$, so we use its estimate $\hat{\sigma}$ in our calculations. Therefore, we use the *t* distribution when we calculate the confidence interval (and conduct hypothesis tests) to account for the extra variability that's been introduced (same reason we use *t* when doing inference for a mean)

- The critical value $t^*$ is calculated from the *t(n-2)* distribution - the *t* distribution with *n-2* degrees of freedom.

---

### Movies data: Critical value

```{r}
qt(0.975, 144)
```

```{r echo = F}
ggplot(data.frame(x = c(-4, 4)), aes(x)) +
  stat_function(fun = dt, args =list(df =144)) +
  stat_function(fun = dt,   args =list(df =144),
                xlim = c(-1.976575, 1.976575),
                geom = "area", fill = "navy") + 
  geom_text(x=0, y=0.15, label="0.95", color = "white", size = 10) +
  geom_text(x = -2.2, y = 0.07, label = "-1.977", size = 3) + 
  geom_text(x =  2.2, y = 0.07, label = "1.977", size = 3)
```

---
### Calculating the 95% CI for $\beta_1$

```{r echo = F}
n <- nrow(movie_scores)
var.x <- var(movie_scores$critics)
sigma <- glance(model)$sigma
beta1 <- tidy(model)$estimate[2]
crit.val <- qt(0.975, n-2)
summaries <- tibble(n = n, 
                    var.x = var.x,
                    sigma = sigma,
                    beta1 = beta1, 
                    crit.val = crit.val)
summaries %>% kable(format = "markdown", digits = 3)
```

.instructions[
Write the equation for the 95% confidence interval for $\beta_1$, the coefficient (slope) of `critics`. 
]

---

### Interpretation 

```{r}
model %>%
  tidy(conf.int=TRUE) %>%
  kable(format = "markdown", digits = 3)
```

.instructions[
Interpret the 95% confidence interval for $\beta_1$, the coefficient (slope) of critics.
]





---

## Recap
--


--


