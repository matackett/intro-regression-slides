---
title: "Simple Linear Regression"
subtitle: "Partioning variability"
author: "Dr. Maria Tackett"
output:
  xaringan::moon_reader:
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    css: "slides.css"
    logo: "img/introregression-sticker.png"
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 4:3
      slideNumberFormat: "%current%"
    seal: false #make custom title slide
editor_options: 
  chunk_output_type: console
---

```{r child = "setup.Rmd"}
```

class: title-slide 

<br><br>

# Simple Linear Regression 
## Partitioning variability
<br><br><br>

### Dr. Maria Tackett

---

## Topics 

--


```{r packages}
library(tidyverse)
library(broom)
library(knitr)
library(kableExtra)
library(patchwork)
library(MASS)
```

---

## Cats data

The data set contains the **heart weight** (.term[Hwt]) and **body weight** (.term[Bwt]) for 144 domestic cats.

```{r echo = F}
ggplot(data = cats, aes(x = Bwt, y = Hwt)) +
  geom_point(alpha = 0.7) + 
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(x = "Body Weight (kg)",
       y = "Heart Weight (g)") +
  theme_bw() +
  theme(axis.title=element_text(size=14))
```

---

## The model

.eq[
$$\hat{\text{Hwt}} = -0.357 + 4.034 \times \text{Bwt}$$
]

<br>

```{r echo = F}
bwt_hwt_model <- lm(Hwt ~ Bwt, data = cats)
bwt_hwt_model %>%
  tidy() %>%
  kable(format = "html", digits = 3)
```

---

## Distribution of response

```{r fig.height = 3}
ggplot(data = cats, aes(x = Hwt)) +
  geom_histogram(fill = "steelblue", color = "grey") +
  labs(x = "Heart Weight (g)") + 
  theme_bw() + 
  theme(axis.title=element_text(size=14))
```


```{r}
cats %>%
  summarise(Mean = mean(Hwt), `Std. Dev.` = sd(Hwt), 
           `IQR` = IQR(Hwt)) %>%
  kable(format = "html", digits = 3)
```

---

class: middle, center

.alert[
How much of the variability in cats' heart weights can be explained by knowing their body weights?
]

---

## ANOVA

We will use .vocab[Analysis of Variance (ANOVA)] to partition the variation in the response variable $Y$.


<br>

```{r fig.align = "center", out.width = '300%'}
include_graphics("img/model-anova.png")
```

---

Plot showing the mean of y and the model 

---

## Total variation 

```{r fig.height = 3}
mean_y <- mean(cats$Hwt)

ggplot(data = cats, aes(x = Bwt, y = Hwt)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = mean_y, color = "blue") +
  geom_segment(aes(x=Bwt, xend=Bwt, y=Hwt, yend=mean_y), color = "black", size = 1) +
  labs(x = "Body Weight (kg)",
       y = "Heart Weight (g)") +
  theme_light() +
  theme(axis.title=element_text(size=14))
```


$$\large{SS_{Total} = \sum_{i=1}^n(y_i - \bar{y})^2 = (n-1)s_y^2}$$

---

## Explained variation (Model)

```{r fig.height = 3}
ggplot(data = cats, aes(x = Bwt, y = Hwt)) +
  geom_point(alpha = 0.4) + 
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  geom_hline(yintercept = mean_y, color = "blue") +
  geom_segment(aes(x=Bwt, xend=Bwt, y = mean_y, yend=predict(bwt_hwt_model)), color = "black", size = 1) +
  labs(x = "",
       y = "") +
  theme_light() +
  theme(axis.title=element_text(size=14))
```

$$\large{SS_{Model} = \sum_{i = 1}^{n}(\hat{y}_i - \bar{y})^2}$$

---

## Unexplained variation (Residuals)

```{r fig.height = 3}
ggplot(data = cats, aes(x = Bwt, y = Hwt)) +
  geom_point(alpha = 0.5) + 
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  geom_hline(yintercept = mean_y, color = "blue") +
  geom_segment(aes(x=Bwt, xend=Bwt, y = Hwt, yend=predict(bwt_hwt_model)), color = "black") +
  labs(x = "Body Weight (kg)",
       y = "Heart Weight (g)") +
  theme_light() +
  theme(axis.title=element_text(size=14))
```


$$\large{SS_{Error} = \sum_{i = 1}^{n}(y_i - \hat{y}_i)^2}$$
]

---

class: middle 

$$\sum_{i=1}^n(y_i - \bar{y})^2 = \sum_{i = 1}^{n}(\hat{y}_i - \bar{y})^2 + \sum_{i = 1}^{n}(y_i - \hat{y}_i)^2$$
---

class: middle 

$$\large{\mathbf{\color{blue}{\sum_{i=1}^n(y_i - \bar{y})^2}}} = \sum_{i = 1}^{n}(\hat{y}_i - \bar{y})^2 + \sum_{i = 1}^{n}(y_i - \hat{y}_i)^2$$

---

class: middle 

$$\sum_{i=1}^n(y_i - \bar{y})^2 = \large{\mathbf{\color{blue}{\sum_{i = 1}^{n}(\hat{y}_i - \bar{y})^2}}} + \sum_{i = 1}^{n}(y_i - \hat{y}_i)^2$$

---

class: middle 

$$\sum_{i=1}^n(y_i - \bar{y})^2 = \sum_{i = 1}^{n}(\hat{y}_i - \bar{y})^2 + \large{\mathbf{\color{blue}{\sum_{i = 1}^{n}(y_i - \hat{y}_i)^2}}}$$
---

## $R^2$


The .vocab[coefficient of determination, $R^2$] is the proportion of variation in the response, $Y$, that is explained by the regression model 

<br> 

--

.eq[
$$R^2 = \large{\frac{SS_{Model}}{SS_{Total}} = 1 - \frac{SS_{Error}}{SS_{Total}}}$$
]

---

## $R^2$ for our model

```{r}
cats_anova <- anova(bwt_hwt_model) %>%
  tidy()

ssm <- round(cats_anova$sumsq[1], 3)
sse <- round(cats_anova$sumsq[2], 3)
sst <- ssm + sse
rsq <- round(ssm/sst, 3)
```

.pull-left[

.small-box-work[
$$SS_{Model} = 548.092$$ 

$$SS_{Error} = 299.533$$ 

$$SS_{Total} = 847.625$$ 
]
]

.pull-right[
.small-box-work[
$$\begin{align}R^2 &= \frac{548.092}{847.625} \\[5pt]
&= 0.647\end{align}$$ 
]
]

--

.eq[
About 64.7% of the variation in the heart weight of cats can be explained by their body weight. 
]

---

## ANOVA table

```{r}
cats_anova %>%
  tidy() 
```



---

## ANOVA test for model


---

## F distribution 


---

## ANOVA test for cats data

---

## Recap

--

- Predicted the response given a value of the predictor variable

--

- Used intervals to quantify the uncertainty in the predicted values 
    - Confidence interval for the mean response
    - Prediction interval for individual response

--

- Defined .vocab[extrapolation] and why we should avoid it
